

from pyspark.sql import SparkSession

sprkSess = SparkSession.builder.appName('pdaSprk_malware_query').getOrCreate()

sql_pda_df = sprkSess.read.csv("hdfs://localhost:54310/pda/sparkML_malware_prediction/df_pda_malware_prediction.csv", header=True, sep=',', inferSchema=True)

sql_pda_df.printSchema()

sql_pda_df.createOrReplaceTempView("sql_pda_dfvw")

sql_pda_qryRes = sprkSess.sql("SELECT Census_OSEdition,COUNT(*) FROM sql_pda_dfvw WHERE HasDetections = 1 group by Census_OSEdition")

sql_pda_qryRes.show()

sql_pda_qryRes.write.format("com.databricks.spark.csv").option("header", "true").save("/pda/SparkSQLOut/spark_df")

